- name: Collect all unique device IDs
  set_fact:
    all_device_ids: "{{ (last_sync_response.keys() | list + last_heartbeat.keys() | list + last_password_set.keys() | list) | unique }}"



- name: Create combined_data
  set_fact:
    combined_data: >-
      {{
        dict(
          [
            (
              device_id,
              {
                'last_sync_response': last_sync_response.get(device_id, ''),
                'last_heartbeat': last_heartbeat.get(device_id, ''),
                'last_password_set': last_password_set.get(device_id, '')
              }
            )
            for device_id in all_device_ids
          ]
        )
      }}
