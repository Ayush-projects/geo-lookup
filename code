# CheckEthernet.ps1

# Function to check network connectivity
function Test-NetworkConnection {
    # Get all network adapters with operational status 'Up'
    $adapters = Get-NetAdapter -Physical | Where-Object { $_.Status -eq 'Up' }

    foreach ($adapter in $adapters) {
        # Get the network connection profile associated with the adapter
        $profile = Get-NetConnectionProfile -InterfaceIndex $adapter.ifIndex -ErrorAction SilentlyContinue
        if ($profile -and $profile.NetworkCategory -ne 'Undefined') {
            # Network is connected and identified
            return $true
        }
    }
    return $false
}

# Loop until connected
while (-not (Test-NetworkConnection)) {
    Write-Host "Network is not connected or still identifying. Killing OOBENetworkConnectionFlow.exe..."

    # Force kill OOBENetworkConnectionFlow.exe as admin
    Get-Process -Name "OOBENetworkConnectionFlow" -ErrorAction SilentlyContinue | Stop-Process -Force

    # Wait for 10 seconds
    Start-Sleep -Seconds 10
}

Write-Host "Connected to the network."
exit 0
